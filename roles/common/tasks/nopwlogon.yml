---
- name: Do not use UsePAM
  become: yes
  lineinfile: path='/etc/ssh/sshd_config'
              regexp='^UsePAM yes'
              state=absent
  notify: restart sshd
  tags: ssh

- name: Do not use ChallengeResponseAuthentication
  become: yes
  lineinfile: path='/etc/ssh/sshd_config'
              regexp='^ChallengeResponseAuthentication yes'
              state=absent
  notify: restart sshd
  tags: ssh

- name: Set UsePAM=no settings
  become: yes
  lineinfile: path='/etc/ssh/sshd_config'
              line='UsePAM no'
              insertafter='^#UsePAM yes'
              state=present
  notify: restart sshd
  tags: ssh

- name: Set PrintMotd yes settings
  become: yes
  lineinfile: path='/etc/ssh/sshd_config'
              line='PrintMotd yes'
              insertafter='^PrintMotd no'
              state=present
  notify: restart sshd
  tags: ssh

- name: Do not use PrintMotd
  become: yes
  lineinfile: path='/etc/ssh/sshd_config'
              regexp='^PrintMotd no'
              state=absent
  notify: restart sshd
  tags: ssh


- name: Restrict ssh logon to authorized keys (ChallengeRespAuth)
  become: yes
  lineinfile: path='/etc/ssh/sshd_config'
              insertafter='^#ChallengeResponseAuthentication yes'
              line='ChallengeResponseAuthentication no'
              state=present
  notify: restart sshd
  tags: ssh

- name: Restrict ssh logon to authorized keys PasswordAuth)
  become: yes
  lineinfile: path='/etc/ssh/sshd_config'
              insertafter='^#PasswordAuthentication yes'
              line='PasswordAuthentication no'
              state=present
  notify: restart sshd
  tags: ssh

- name: Make sure there is a .ssh directory
  file:
    path: /home/volumio/.ssh/
    state: directory
    owner: volumio
    group: volumio
    mode: 0700
  tags: ssh

- name: Copy authorized_keys to .ssh
  copy:
    src: authorized_keys
    dest: /home/volumio/.ssh/authorized_keys
    owner: volumio
    group: volumio
    mode: 0600
  tags: ssh


